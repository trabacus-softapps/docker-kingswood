<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<!--####################################################### Search view ################################################################ -->
		
		<record id="kw_stock_search" model="ir.ui.view">
            <field name="name">stock.picking.out.search</field>
            <field name="model">stock.picking.out</field>
            <field name="arch" type="xml">
                <search string="Picking list">
                    <field name="name" string="Reference Picking List" filter_domain="['|',('name','ilike', self),('origin','ilike',self)]"/>
                    <field name="product" string="Product List" filter_domain="[('product','ilike', self)]"/>
                    <field name="partner_id" string="Customer" />
                    <!-- <field name="product" /> -->
                    <field name="paying_agent_id"/>
                    <field name="state"/>
                    <field name="date"/>
                    <field name="truck_no" />
                    <field name="work_order"/>
					<field name="esugam_no"/>
                    <field name="truck_no" />
                    <!-- <field name="stock_journal_id" groups="account.group_account_user"/>
                    <field name="driver_name" string="Transporter Name"/>  -->
                    <field name="state" />
                     <field name="location_id" invisible="0"/>
                    <filter icon="terp-check" name="draft" string="Draft" domain="[('state','=','draft')]" help="Assigned Delivery Orders"/>
                    <filter icon="terp-camera_test" name="in_transit" string="In transit" domain="[('state','=','in_transit')]" help="Confirmed Delivery Orders"/>
                    <filter icon="terp-dialog-close" name="done" string="Done" domain="[('state','=','done')]" help="Delivery orders already processed"/>
                    
                    
                    <separator/>
                    <filter icon="terp-accessories-archiver-minus" string="Back Orders" domain="[('backorder_id', '!=', False)]" help="Is a Back Order"/>
                    <separator/>
                    <filter icon="terp-dolar" name="to_invoice" string="To Invoice" domain="[('invoice_state','=','2binvoiced')]" help="Delivery orders to invoice"/>
                    <field name="partner_id" filter_domain="[('partner_id','child_of',self)]"/>
                    <field name="stock_journal_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <group expand="0" string="Group By...">
                        <filter string="Status" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <filter string="Order Date" icon="terp-go-month" domain="[]"  context="{'group_by':'date'}"/>
                       	<filter string="Transporter Name" icon="terp-go-month" domain="[]"  context="{'group_by':'driver_name'}"/> 
                        <filter string="Work Order Number " icon="terp-folder-orange" domain="[]" context="{'group_by':'work_order'}"/>
                        <filter string="Customer" icon="terp-folder-orange" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Product" icon="terp-folder-orange" domain="[]" context="{'group_by':'product'}"/>
                        <filter string="Suppliers" icon="terp-folder-orange" domain="[]" context="{'group_by':'paying_agent_id'}"/>

                    </group>
                </search>
            </field>
       </record>	
		
		
		
		
		
		<!--####################################################### TREE view ################################################################ -->
		
		<record id="kw_stock_tree" model="ir.ui.view">
            <field name="name">stock.picking.out.tree</field>
            <field name="model">stock.picking.out</field>
            <field name="arch" type="xml">
                <tree colors="blue:state == 'draft';grey:state == 'cancel';red:state not in ('cancel', 'done') and min_date &lt; current_date" string="Delivery challan">
                    <field name="name" /> <!-- attrs="{'invisible': [('state','=','draft')]}" -->
                    <field name="partner_id" string="Customer"/>
                    <field name="date" />
                    <field name="product"/>
                	<field name="price_unit"/>
                    <field name="qty"/>
                    <field name="paying_agent_id" readonly='1'/>
                    <field name="work_order" invisible='1'/>
                    <field name='min_date' invisible='1'/>
                    <field name="product_id" invisible="1"/> 
                	
                    <field name="esugam_no" string="E-Sugam No."/>
                    <!-- <field name="stock_journal_id" groups="account.group_account_user"/> -->
                    <!-- <field name="driver_name" string="Transporter Name"/> -->
                    <field name="transporter"/>
                    <field name="state"/>
                    <field name="stock_journal_id" invisible='1' />
                </tree>
            </field>
       </record>	
       
       
       <!-- ############################### Move lines Tree view #############################################################  -->
       
       <record id="kw_view_move_picking_tree" model="ir.ui.view">
            <field name="name">stock.move.tree</field>
            <field name="model">stock.move</field>
            <field eval="4" name="priority"/>
            <field name="arch" type="xml">
            	<tree string="Stock Moves" version="7.0" editable='top' >
            		<field name="state" invisible="1" />
		                 <field name="hide_fields" invisible="1"/>
						<field name="product_id" context="{'partner_id':parent.partner_id}"
							
						on_change="onchange_product_id(product_id,location_id,location_dest_id,parent.partner_id)" string="Goods Details"
						attrs="{'readonly': [('hide_fields', '=', False),('state','in',('done'))]}"/>
							
						<field name="price_unit" attrs="{'readonly': [('hide_fields', '=', False),('state','in',('done'))]}"/>
						<field name="product_qty" string="Loaded Quantity" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"/>
						 <field name="name" invisible="1"/>
						<field name="product_uos" groups="product.group_uos" invisible="1"/>
						<!-- <field name="location_id" groups="stock.group_locations" invisible="0"/> -->
						<field name="location_id" groups="base.group_no_one,kingswood.kw_admin_service,kingswood.kw_depot_service"/>
						<field name="location" groups="kingswood.kw_supplier_service"/>
						<field name="picking_id" invisible="1"/>
						<field name="create_date" invisible="1"/>
						<field name="date_expected" invisible="1"/>
						<field name="scrapped" invisible="1"/>
            		    <field name="hide_fields" invisible="1"/>
						<field name="prodlot_id" groups="stock.group_production_lot"/>
							<button
							  name="%(stock.track_line)d"
							   string="Split in Serial Number"
							   groups="stock.group_production_lot"
							   type="action" icon="gtk-justify-fill"
							   states="draft,waiting,confirmed,assigned"/>
						<field groups="stock.group_tracking_lot" name="tracking_id"/>
							    <button name="setlast_tracking" string="Put in current pack" type="object"
							      attrs="{'invisible': [('tracking_id','&lt;&gt;',False)]}"
							      icon="terp-accessories-archiver"
							      groups="stock.group_tracking_lot"
							     states="draft,assigned,confirmed"/>
							     <button name="%(stock.split_into)d" string="Put in a new pack" type="action"
							     groups="product.group_stock_packaging"
							     icon="terp-accessories-archiver+"
							       states="draft,assigned,confirmed"/>
						<field name="location_dest_id" groups="stock.group_locations" invisible="1"/>
            			<field name="delivery_date" attrs="{'readonly': [('hide_fields', '=', False)]}"/>
		                <field name="unloaded_qty" attrs="{'readonly': [('hide_fields', '=', False)]}"/>
		                <field name="rejected_qty" attrs="{'readonly': [('hide_fields', '=', False)]}"/>
            			<field name="deduction_amt" attrs="{'readonly': [('hide_fields', '=', False)]}" />
						<field name="state" invisible="1"/>
						                      
						<field name="product_uom" 
							context="{'default_product_uom':product_uom'}" 
							invisible="1"
							string="Unit of Measure" groups="product.group_uom"/>
		             </tree>
            </field>
       </record>
      
      <!--  -->
       <record id="kw_view_move_picking_form" model="ir.ui.view">
            <field name="name">stock.move.tree</field>
            <field name="model">stock.move</field>
            <field eval="4" name="priority"/>
            <field name="arch" type="xml">
          			<form string="Stock Moves" version="7.0">
						                <header>
						                   
						                	<!--<button name="%(stock.action_partial_move_server)d" string="Process Partially" type="action" states="assigned" class="oe_highlight"/>
						                    <button name="action_done" states="draft,assigned,confirmed" string="Process Entirely" type="object" class="oe_highlight"/>
						                    <button name="force_assign" states="confirmed" string="Set Available" type="object" class="oe_highlight"/>
						                    <button name="action_cancel" states="assigned,confirmed" string="Cancel Move" type="object"/>-->
						                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,assigned,done" statusbar_colors='{"waiting":"blue","confirmed":"blue"}'/>
						                </header>
						                <sheet>
						                    <group >
						                        <group name="main_grp" string="Details">
						                        	
						                            <field name="product_id"  on_change="onchange_product_id(product_id,location_id,location_dest_id, False)" widget='selection'
						                            	/>
						                            <label for="product_qty"/>
						                            <div>
						                                <field name="product_qty"
						                                    on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"
						                                    class="oe_inline"/>
						                                <field name="product_uom" groups="product.group_uom" class="oe_inline"/>
						                                <button name="%(stock.move_scrap)d"
						                                        string="Scrap" type="action"
						                                        icon="terp-gtk-jump-to-ltr" context="{'scrap': True}"
						                                        states="draft,waiting,confirmed,assigned" colspan="1"/>
						                            </div>
						                            <label for="product_uos_qty" groups="product.group_uos"/>
						                            <div groups="product.group_uos">
						                                <field name="product_uos_qty"
						                                    on_change="onchange_uos_quantity(product_id, product_uos_qty, product_uos, product_uom)"
						                                    class="oe_inline"/>
						                                <field name="product_uos" class="oe_inline"/>
						                            </div>
						                            
						                            <field name="name"/>
						                            <field name="company_id" groups="base.group_multi_company" widget="selection"/>
						                        </group>
						                        <group name="origin_grp" string="Origin">
						                            <field name="origin"/>
						                            <field name="picking_id" domain="[('type','=',type)]"/>
						                             <field name="type" on_change="onchange_move_type(type)"/>
						                            <field name="location_id" groups="stock.group_locations" invisible="1"/>
						                           
						                            <field name='supplier_id' readonly='0'/>
						                            <field name="create_date" groups="base.group_no_one"/>
						                        </group>
						                        <group name="destination_grp" string="Destination">
						                            <field name="location_dest_id" groups="stock.group_locations"/>
						                            <field name="partner_id"  context="{'contact_display':'partner'}" groups="stock.group_locations" />
						                            <!-- <field name="addr"/>  -->
						                            <field name="date_expected" on_change="onchange_date(date,date_expected)" attrs="{'invisible': [('state', '=', 'done')]}"/>
						                            <field name="date" attrs="{'invisible': [('state', '!=', 'done')]}"/>
						                        </group>
						                        <group string="Traceability"
						                            groups="stock.group_tracking_lot">
						                            <label for="tracking_id" groups="stock.group_tracking_lot"/>
						                            <div groups="stock.group_tracking_lot">
						                                <field name="tracking_id" class="oe_inline"/><!-- on_change="onchange_product_id(product_id,location_id,location_dest_id,parent.partner_id)"  -->
						                                <button name="%(stock.split_into)d" string="New Pack" type="action"
						                                      groups="product.group_stock_packaging"
						                                      icon="terp-accessories-archiver+" 
						                                      states="draft,assigned,confirmed"/>
						                            </div>
						                            <label for="prodlot_id" groups="stock.group_production_lot"/>
						                            <div groups="stock.group_production_lot">
						                                <field name="prodlot_id"
						                                    context="{'location_id':location_id, 'product_id':product_id}"
						                                    domain="[('product_id','=?',product_id)]" class="oe_inline"
						                                    on_change="onchange_lot_id(prodlot_id,product_qty, location_id, product_id, product_uom)"/>
						                                <button name="%(stock.track_line)d"
						                                    states="draft,waiting,confirmed,ass igned"
						                                    string="Split" type="action" icon="gtk-justify-fill"/>
						                            </div>
						                        </group>
						                    </group>
						                </sheet>
						                </form> 
						      </field>
						 </record>
      
      
      
      
      
      
        <!-- ############################################# Form view ###########################################################-->
		
		  <record model="ir.ui.view" id="kw_stock_form">
				<field name="name">kw.stock.form</field>
				<field name="model">stock.picking.out</field>
				<field name="type">form</field>
				<field name="arch" type="xml">
					<form string="Delivery challan" version="7.0">
						
							
            			<header>
            				<button name="deliver" states="in_transit" string="Goods Accepted" type="object" class="oe_highlight" groups="kingswood.kw_customer_service,kingswood.kw_admin_service"/>
            				<button name="kw_confirm" states="draft" string="Confirm" type="object" confirm="Do You Really Want To Confirm As It Cannot Be Cancelled.You Need To Contact Kingswood Administrator For Cancellation" 
            					class="oe_highlight" groups="kingswood.kw_supplier_service,kingswood.kw_admin_service,kingswood.kw_depot_service,kingswood.kw_freight_service"/>
            				<button name="kw_pay_freight" states="done" string="Pay Freight" type="object" class="oe_highlight" groups="kingswood.kw_freight_service,kingswood.kw_admin_service"/>
            				<button name="%(del_refund_action)d" states = "done,freight_paid" string="Refund" type="action" class="oe_highlight" groups="kingswood.kw_admin_service"/>
            				<button name="button_cancel" states="draft,in_transit" string="Cancel" groups="kingswood.kw_admin_service" attrs="{'invisible':[('user_log', '!=', 'KW_Admin')]}"/>
            					
            				
							 	<!--<button name="draft_force_assign" states="draft" string="Confirm" type="object" class="oe_highlight" groups="base.group_user"/>
                    			<button name="draft_validate" states="draft" string="Confirm &amp; Transfer" type="object" class="oe_highlight" groups="base.group_user"/>
			                    <button name="action_assign" states="confirm" string="Check Availability" type="object" class="oe_highlight"/> 
			                    <button name="force_assign" states="confirm" string="Force Availability" type="object" class="oe_highlight" groups="base.group_user"/>
			                    <button name="action_process" states="assigned" string="Confirm &amp; Transfer" groups="stock.group_stock_user" type="object" class="oe_highlight"/>
			                    <button name="302" string="Create Invoice/Refund" attrs="{'invisible': ['|','|',('state','&lt;&gt;','confirmed'),('invoice_state','=','invoiced'),('invoice_state','=','none')]}" type="action" class="oe_highlight" groups="base.group_user"/>
			                    <button name="308" string="Reverse Transfer" states="done" type="action" groups="base.group_user"/>
			                    -->
            				<field name="state" widget="statusbar" statusbar_visible="draft,in_transit,done,freight_paid" statusbar_invisible='confirmed'/>
						</header>
               			<sheet>
		                    
							<separator string="DELIVERY CHALLAN - CUM - FREIGHT ADVICE" version="7.0"/>
						            
			          
		                    <h1>
		                        <field name="name" class="oe_inline" attrs="{'invisible': [('name','=','/')]}" readonly="1"/>
		                    </h1>
		                    <group col='6' colspan='2'>
		                        <group>
		                        	<!-- <field name="customer_list" invisible="1"/> -->
		                        	<field name="partner_id" on_change="onchange_partner_in(partner_id)"  string="Customer"  
		                        		
		                        		 attrs="{'readonly':[('state', 'in', ('in_transit','done','balance_paid','freight_paid','cancel'))],
		                        		 		 'required':[('state', '!=', ('in_transit','done','balance_paid','freight_paid'))]}"/>
		                        		 
		                        		 
		                        		
		                        		 	 
		                        	<field name="purchase_id" invisible="1"/> 	 
		                        	
								 <field name="invoice_line_id" invisible="1"/>
									
									<field name="product_id" invisible="1"/> 
									<!-- domain="[('customer','=',True)]" -->
		                        	<field name="hide_fields" invisible="1" />	
		                            <field name="backorder_id" readonly="1" attrs="{'invisible': [('backorder_id','=',False)]}"/> <!--('customer','=',True), domain="[('partner_id','in','customer_ids')]"-->
		                            <field name="invoice_state" string="Invoice Control" groups="account.group_account_invoice" attrs="{'invisible':[('invoice_state', '=', 'none')]}"/>
		                            <field name="stock_journal_id" widget="selection" groups="account.group_account_user" invisible="1"/>
		                            <field name="min_date" readonly="1" attrs="{'invisible': [('min_date','=',False)]}" invisible="1"/>
		                            <field name="esugam_no" string="E-SUGAM Number" required='1'  readonly="1"/>
		                            	<!-- attrs="{'readonly':[('state', 'in', ('in_transit','done','balance_paid','freight_paid','cancel'))]}"/> -->
		                        	<field name="paying_agent_id" domain="[('supplier','=',True)]" on_change="onchange_paying_agent(paying_agent_id,transporter_id)" 
		                        		groups="kingswood.kw_admin_service,kingswood.kw_depot_service" 
		                        		attrs="{'required':['|',('user_log','=','KW_Admin'),('user_log','=','KW_Depot')]}"/>
		                        	<!-- domain="['|','&amp;',('supplier','=',True),('supplier','!=',True),('customer','!=',True)]" -->
		                     		
		                        </group>
		                        
		                        <group>
		                        	<field name="origin" placeholder="e.g. PO0032" class="oe_inline" invisible="1"/>
		                            <field name="date" string="Creation Date" invisible='1' /> <!-- attrs="{'readonly': [('state','in',('freight_paid'))]}" -->
		                            <field name="date_function"/>
		                            <field name="work_order"/>
		                            
								 </group>
		                    	
							 </group>
		                    <hr/>
		                    
		                    <group col='6' colspan='2'>
		                    	
		                    	<group>
		                    		<field name="city_id" attrs="{'readonly': [('state','not in',('draft'))]}"/>
		                     		<field name="driver_name" 
		                     			attrs="{'invisible': [('paying_agent', '=', 'kingswood')],'readonly':[('state', 'in', ('in_transit','done','balance_paid','freight_paid','cancel'))]}"/>
		                     		<field name='user_log' invisible="1"/>
		                     		<field name="paying_agent" 
		                     			invisible="1"/>
		                    		<field name="transporter_id" domain="[('supplier','=',True)]" on_change ="onchange_transporter_id(paying_agent_id,transporter_id)"
										attrs="{'required': [('paying_agent','=', 'kingswood')],'invisible':[('paying_agent','!=','kingswood')],'readonly':[('state','!=','draft')]}"
										
										
										groups="kingswood.kw_admin_service,kingswood.kw_depot_service"/>
										
			                     	<field name="truck_no" required='1' attrs="{'readonly':[('state', 'in', ('in_transit','done','balance_paid','freight_paid','cancel'))]}"/>
			                     	
			                     	
			                     	<field name="diver_contact" string="Transporter Contact" />
			                     </group>
		                    
			                    <group >
			                    	
			                    	
			                    	<field name="freight_charge" string="Freight Rate/MT"/> 
			                        <field name="freight_total" attrs="{'invisible':[('state','not in',('done','freight_paid'))]}"/>
			                        <field name="freight_advance" />
	
			                        <!-- <field name="driver_name" string="Transporter Name"/> -->
			                        
			                    	<field name="freight_deduction" attrs="{'invisible': [('state','in',('draft','in_transit'))]}"/>
			                    	<field name="freight_balance" attrs="{'invisible': [('state','in',('draft','in_transit'))]}"/>
			                    	
			                    </group>	
		                     
		                     
		                     
		                    	 	
		                     	
		                     </group>
		                    <notebook>
		                        <page string="Goods Details" >
		                            <field name="move_lines" context="{'default_partner_id':partner_id,'address_in_id': partner_id,'form_view_ref':'kingswood.kw_view_move_picking_form','tree_view_ref':'kingswood.kw_view_move_picking_tree','picking_type': 'out','paying_agent_id':paying_agent_id}"
		                            	 options="{&quot;reload_on_button&quot;: true}" attrs="{'readonly':['|',('state','in',('done','freight_paid','cancel')),'&amp;',('user_log', '=', 'KW_Supplier'),('state','in',('in_transit','done','freight_paid','cancel'))]}"/>
		                            	 <!-- attrs="{'readonly': ['|',('hide_fields', '=', False),('state','in',('done','freight_paid'))]}" -->
		                            	 
		                            	 
		                            	             	
                            <field name="note" placeholder="Add an internal note..." class="oe_inline"/>
                        </page>
                        
                    </notebook>
                </sheet>
				</form>
 			</field>	
		</record>
		


<!--###################################################################### Action ############################################################ -->
   
	
        
        <!-- <menuitem action="action_picking_tree" id="menu_action_picking_tree" parent="menu_stock_warehouse_mgmt" sequence="3" invisible="1"/> -->

		<record model="ir.actions.act_window" id="kw_stock_action">
            	<field name="name">Delivery Challan</field>
            	<field name="type">ir.actions.act_window</field>
            	<field name="res_model">stock.picking.out</field>
            	<field name="view_type">form</field>
				<field name="domain">[('type','=','out')]</field>
				<field name="context">{'default_type':'out','type':'out'}</field>
            	<field name="view_mode">tree,form</field>
            	<field name="search_view_id" ref="kw_stock_search"/>
			
	     </record>
	    
	   <record id="kw_stock_action_tree" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="kw_stock_tree"/>
            <field name="act_window_id" ref="kw_stock_action"/>
        </record>
	        
	        <record model="ir.actions.act_window.view" id="kw_stock_action_form">
	        	<field name="view_mode">form</field>
	        	<field eval="2" name="sequence"/>
	        	<field name="view_id" ref="kw_stock_form"/>
	        	<field name="act_window_id" ref="kw_stock_action"/>
	        </record>	
	     
	<menuitem action="kw_stock_action" name="Delivery Challan" id="kw_menu_action_picking_tree" parent="stock.menu_stock_warehouse_mgmt" sequence="3"
		groups="base.group_no_one,kingswood.kw_admin_service,kingswood.kw_depot_service,kingswood.kw_supplier_service"/>
	
	
	
	<!-- *************************************************************************Customer Search ******************************************-->
	
	<record id="kw_customer_search" model="ir.ui.view">
            <field name="name">stock.picking.out.search</field>
            <field name="model">stock.picking.out</field>
            <field name="arch" type="xml">
                <search string="Picking list">
                    <field name="name" string="Reference Picking List" filter_domain="['|',('name','ilike', self),('origin','ilike',self)]"/>
                    <field name="product" string="Product List" filter_domain="[('product','ilike', self)]"/>
                    <field name="partner_id" string="Customer" />
                    
                    <field name="paying_agent_id"/>
                    <field name="state"/>
                    <field name="date"/>
                    <field name="truck_no" />
                    <field name="work_order"/>
					<field name="esugam_no"/>
                    <field name="truck_no" />
                    
                    <field name="state"/>
                    
                    <filter icon="terp-check" name="draft" string="Draft" domain="[('state','=','draft')]" help="Assigned Delivery Orders"/>
                    <filter icon="terp-camera_test" name="in_transit" string="In transit" domain="[('state','=','in_transit')]" help="Confirmed Delivery Orders"/>
                    <filter icon="terp-dialog-close" name="done" string="Done" domain="[('state','=','done')]" help="Delivery orders already processed"/>
                    
                    
                    <separator/>
                    <filter icon="terp-accessories-archiver-minus" string="Back Orders" domain="[('backorder_id', '!=', False)]" help="Is a Back Order"/>
                    <separator/>
                    <filter icon="terp-dolar" name="to_invoice" string="To Invoice" domain="[('invoice_state','=','2binvoiced')]" help="Delivery orders to invoice"/>
                    <field name="partner_id" filter_domain="[('partner_id','child_of',self)]"/>
                    <field name="stock_journal_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <group expand="0" string="Group By...">
                        <filter string="Status" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <filter string="Order Date" icon="terp-go-month" domain="[]"  context="{'group_by':'date'}"/>
                       	<filter string="Transporter Name" icon="terp-go-month" domain="[]"  context="{'group_by':'driver_name'}"/> 
                        <filter string="Work Order Number " icon="terp-folder-orange" domain="[]" context="{'group_by':'work_order'}"/>
                        <filter string="Customer" icon="terp-folder-orange" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Product" icon="terp-folder-orange" domain="[]" context="{'group_by':'product'}"/>
                        <filter string="Suppliers" icon="terp-folder-orange" domain="[]" context="{'group_by':'paying_agent_id'}"/>

                    </group>
                </search>
            </field>
       </record>
       
       <!-- *************************************************************************Customer Tree ******************************************-->
       
	 <record id="kw_customer_tree" model="ir.ui.view">
            <field name="name">stock.picking.out.tree</field>
            <field name="model">stock.picking.out</field>
            <field name="arch" type="xml">
                <tree colors="blue:state == 'draft';grey:state == 'cancel';red:state not in ('cancel', 'done') and min_date &lt; current_date" string="Delivery challan">
                    <field name="name" /> <!-- attrs="{'invisible': [('state','=','draft')]}" -->
                    <field name="partner_id" string="Customer"/>
                    <field name="date" />
                    <field name="product"/>
                     <field name="qty"/>
                     <field name="paying_agent_id" invisible='1'/>
                    <field name="work_order" invisible='1'/>
                    <field name='min_date' invisible='1'/>
                    
                    
                    <field name="esugam_no" string="E-Sugam No."/>
                    <!-- <field name="stock_journal_id" groups="account.group_account_user"/> -->
                    <field name="driver_name" string="Transporter Name"/>
                    <field name="state"/>
                    <field name="stock_journal_id" invisible='1' />
                </tree>
            </field>
       </record> 
	
	<!-- *************************************************************************Customer Form ******************************************-->
	
	 <record model="ir.ui.view" id="kw_customer_stock_form">
				<field name="name">kw.customer.stock.form</field>
				<field name="model">stock.picking.out</field>
				<field name="type">form</field>
				<field name="arch" type="xml">
					<form string="Delivery challan" version="7.0">
            			<header>
            				<button name="kw_confirm" states="draft" string="Confirm" type="object" class="oe_highlight" groups="kingswood.kw_supplier_service,kingswood.kw_depot_service,kingswood.kw_freight_service"/>
            				<button name="deliver" states="in_transit" string="Goods Accepted" type="object" class="oe_highlight" groups="kingswood.kw_customer_service"/>
            				<button name="kw_pay_freight" states="done" string="Pay Freight" type="object" class="oe_highlight" groups="kingswood.kw_freight_service,kingswood.kw_admin_service"/>
            				
            				<field name="state" widget="statusbar" statusbar_visible="draft,in_transit,done,freight_paid" statusbar_invisible='confirmed'/>
						</header>
               			<sheet>
		                    
							<separator string="DELIVERY CHALLAN - CUM - FREIGHT ADVICE" version="7.0"/>
						            
			          
		                    <h1>
		                        <field name="name" class="oe_inline" attrs="{'invisible': [('name','=','/')]}" readonly="1"/>
		                    </h1>
		                     <group col='6' colspan='2'>
		                        <group>
		                        	<field name="partner_id" on_change="onchange_partner_in(partner_id)" required="1" string="Customer"  domain="[('customer','=',True)]" attrs="{'readonly':[('state', 'in', ('in_transit','done','balance_paid'))]}" readonly="1"
		                        		 widget='selection'/>
		                            <field name="backorder_id" readonly="1" attrs="{'invisible': [('backorder_id','=',False)]}"/>
		                            <field name="invoice_state" string="Invoice Control" groups="account.group_account_invoice" attrs="{'invisible':[('invoice_state', '=', 'none')]}" readonly="1"/>
		                            <field name="stock_journal_id" widget="selection" groups="account.group_account_user" invisible="1" readonly="1"/>
		                            <field name="min_date" readonly="1" attrs="{'invisible': [('min_date','=',False)]}" invisible="1"/>
		                            <field name="esugam_no" string="E-SUGAM Number" readonly="1"/>
		                        	<!-- <field name="paying_agent_id" 
		                        		groups="kingswood.kw_admin_service,kingswood.kw_depot_service"/> -->
		                        </group>
		                        
		                        <group>
		                        	<field name="origin" placeholder="e.g. PO0032" class="oe_inline" invisible="1"/>
		                            <field name="date" string="Creation Date" readonly='1' />
		                            <field name="work_order" readonly="1"/> 
								 </group>
		                    	
							 </group>
		                    <hr/>
		                    
		                    <group col='6' colspan='2'>
		                    	
		                    	<group>
		                    		<field name="paying_agent" invisible="1"/>
		                    		<field name="city_id" attrs="{'readonly': [('state','not in',('draft'))]}"/>
		                     		<field name="driver_name" readonly="1"
		                     			attrs="{'invisible': [('paying_agent', '=', 'kingswood')]}"/>
		                     			/>
		                    		<field name="transporter_id" groups="kingswood.kw_customer_service" readonly="1"
		                    			attrs="{'invisible':[('paying_agent','!=','kingswood')]}"/> 
		                    			
			                     	<field name="truck_no" readonly="1"/>
			                     	
			                     	<field name="diver_contact" string="Transporter Contact" readonly="1"/>
			                     </group>
		                    
			                    <group >
			                    	
			                    	
			                        <field name="freight_charge" string="Freight Rate/MT"/>
			                    	<field name="freight_total" attrs="{'invisible':[('state','not in',('done','freight_paid'))]}"/>
			                        <field name="freight_advance" readonly="1"/>
	
			                        <!-- <field name="driver_name" string="Transporter Name"/> -->
			                        
			                    	<field name="freight_deduction" attrs="{'invisible': [('state','in',('draft','in_transit'))]}"/>
			                    	<field name="freight_balance" attrs="{'invisible': [('state','in',('draft','in_transit'))]}"/>
			                    	
			                    </group>
			                   </group>	
		                    <notebook>
		                        <page string="Goods Details">
		                            <field name="move_lines" context="{'default_partner_id':partner_id,'address_in_id': partner_id, 'form_view_ref':'view_move_picking_form', 'tree_view_ref':'view_move_picking_tree', 'picking_type': 'out'}"
		                            	 options="{&quot;reload_on_button&quot;: true}">
		                            	 <tree string="Stock Moves" version="7.0" editable='top'>
		                            	 	<field name="hide_fields" invisible="1"/>
							        			<field name="product_id" context="{'partner_id':parent.partner_id}" string="Goods Details" 
							        				widget='selection' attrs="{'readonly': [('hide_fields', '=', True)]}"
							        				on_change="onchange_product_id(product_id,location_id,location_dest_id,parent.partner_id)" />
							        				
							        			<field name="price_unit" attrs="{'readonly': [('hide_fields', '=', True)]}" />
							                    <field name="product_qty" string="Loaded Quantity" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)" readonly="1"/>
							                    <!-- <field name="product_uom" string="Unit of Measure" groups="product.group_uom" invisible="1"/> -->
							                    <field name="name" invisible="1"/>
							                    <field name="product_uos" groups="product.group_uos" invisible="1"/>
							                    <field name="location_id" groups="stock.group_locations" invisible="1"/>
							                    <field name="picking_id" invisible="1" />
							                    <field name="create_date" invisible="1" />
							                    <field name="date_expected" invisible="1" />
							                    
							                    <field name="scrapped" invisible="1"/>
							                    <field name="prodlot_id" groups="stock.group_production_lot"/>
							                    <button
							                       name="%(stock.track_line)d"
							                       string="Split in Serial Number"
							                       groups="stock.group_production_lot"
							                       type="action" icon="gtk-justify-fill"
							                       states="draft,waiting,confirmed,assigned"/>
							                     <field groups="stock.group_tracking_lot" name="tracking_id"/>
							                     <button name="setlast_tracking" string="Put in current pack" type="object"
							                        attrs="{'invisible': [('tracking_id','&lt;&gt;',False)]}"
							                        icon="terp-accessories-archiver"
							                        groups="stock.group_tracking_lot"
							                        states="draft,assigned,confirmed"/>
							                     <button name="%(stock.split_into)d" string="Put in a new pack" type="action"
							                        groups="product.group_stock_packaging"
							                        icon="terp-accessories-archiver+"
							                        states="draft,assigned,confirmed"/>
							                      <field name="location_dest_id" groups="stock.group_locations" invisible="1"/>
		                            	 	<field name="delivery_date"/>	
		                            	 	<field name="unloaded_qty" />
		                            	 		<field name="rejected_qty"/>
		                            	 	   <field name="deduction_amt"/>
							                      <field name="state" invisible="1"/>
							                      
							                      <field name="product_uom" context="{'default_product_uom':product_uom'}" string="Unit of Measure" groups="product.group_uom" readonly="1"/>
		               					 </tree>
               					 
<!-- ********************************************* one to many form ******************************************************-->


						              <form string="Stock Moves" version="7.0">
						                <header>
						                   
						                	
						                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,assigned,done" statusbar_colors='{"waiting":"blue","confirmed":"blue"}'/>
						                </header>
						                <sheet>
						                    <group>
						                        <group name="main_grp" string="Details">
						                            <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, False)"/>
						                            <label for="product_qty"/>
						                            <div>
						                                <field name="product_qty"
						                                    on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"
						                                    class="oe_inline"/>
						                                <field name="product_uom" groups="product.group_uom" class="oe_inline"/>
						                                <button name="%(stock.move_scrap)d"
						                                        string="Scrap" type="action"
						                                        icon="terp-gtk-jump-to-ltr" context="{'scrap': True}"
						                                        states="draft,waiting,confirmed,assigned" colspan="1"/>
						                            </div>
						                            <label for="product_uos_qty" groups="product.group_uos"/>
						                            <div groups="product.group_uos">
						                                <field name="product_uos_qty"
						                                    on_change="onchange_uos_quantity(product_id, product_uos_qty, product_uos, product_uom)"
						                                    class="oe_inline"/>
						                                <field name="product_uos" class="oe_inline"/>
						                            </div>
						                            <field name="name"/>
						                            <field name="company_id" groups="base.group_multi_company" widget="selection"/>
						                        </group>
						                        <group name="origin_grp" string="Origin">
						                            <field name="origin"/>
						                            <field name="picking_id" domain="[('type','=',type)]"/>
						                             <field name="type" on_change="onchange_move_type(type)"/>
						                            <field name="location_id" groups="stock.group_locations"/>
						                            <field name='supplier_id' readonly='1'/>
						                            <field name="create_date" groups="base.group_no_one"/>
						                        </group>
						                        <group name="destination_grp" string="Destination">
						                            <field name="location_dest_id" groups="stock.group_locations"/>
						                            <field name="partner_id"  context="{'contact_display':'partner'}" groups="stock.group_locations" />
						                            <!-- <field name="addr"/>  -->
						                            <field name="date_expected" on_change="onchange_date(date,date_expected)" attrs="{'invisible': [('state', '=', 'done')]}"/>
						                            <field name="date" attrs="{'invisible': [('state', '!=', 'done')]}"/>
						                        </group>
						                        <group string="Traceability"
						                            groups="stock.group_tracking_lot">
						                            <label for="tracking_id" groups="stock.group_tracking_lot"/>
						                            <div groups="stock.group_tracking_lot">
						                                <field name="tracking_id" class="oe_inline"/>
						                                <button name="%(stock.split_into)d" string="New Pack" type="action"
						                                      groups="product.group_stock_packaging"
						                                      icon="terp-accessories-archiver+"
						                                      states="draft,assigned,confirmed"/>
						                            </div>
						                            <label for="prodlot_id" groups="stock.group_production_lot"/>
						                            <div groups="stock.group_production_lot">
						                                <field name="prodlot_id"
						                                    context="{'location_id':location_id, 'product_id':product_id}"
						                                    domain="[('product_id','=?',product_id)]" class="oe_inline"
						                                    on_change="onchange_lot_id(prodlot_id,product_qty, location_id, product_id, product_uom)"/>
						                                <button name="%(stock.track_line)d"
						                                    states="draft,waiting,confirmed,assigned"
						                                    string="Split" type="action" icon="gtk-justify-fill"/>
						                            </div>
						                        </group>
						                    </group>
						                </sheet>
						                </form>
               				 </field>            	
                            <field name="note" placeholder="Add an internal note..." class="oe_inline"/>
                        </page>
                       
                    </notebook>
                	</sheet>
				</form>
 			</field>	
		</record>
		
		
	<record model="ir.actions.act_window" id="kw_customer_action">
            	<field name="name">Delivery challan</field>
            	<field name="type">ir.actions.act_window</field>
            	<field name="res_model">stock.picking.out</field>
            	<field name="view_type">form</field>
				<field name="domain">[('type','=','out')]</field>
				<field name="context">{'default_type':'out', 'type':'out'}</field>
            	<field name="view_mode">tree,form</field>
            	<field name="search_view_id" ref="kw_stock_search"/>
			
	     </record>
	    
	   <record id="kw_customer_action_tree" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="kw_customer_tree"/>
            <field name="act_window_id" ref="kw_customer_action"/>
        </record>
	        
	        <record model="ir.actions.act_window.view" id="kw_customer_action_form">
	        	<field name="view_mode">form</field>
	        	<field eval="2" name="sequence"/>
	        	<field name="view_id" ref="kw_customer_stock_form"/>
	        	<field name="act_window_id" ref="kw_customer_action"/>
	        </record>	
	     
	<menuitem action="kw_customer_action" name="Delivery Challan" id="kw_menu_action_customer_tree" parent="stock.menu_stock_warehouse_mgmt" sequence="3"
		groups="kingswood.kw_customer_service"/>	
	
	
	
	
	
	
<!-- ******************************************* To replace all string contains "Products" by "Goods" ***************************************************-->

	<record id="kw_shipment" model="ir.ui.view">
            <field name="name">kw.stock</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_picking_tree"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@name='product_id']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 				 <xpath expr="//tree[@string='Stock Moves']" position="attributes">
                    <attribute name="editable">top</attribute>
 				</xpath>
 				<xpath expr="//field[@name='product_id']" position="after">
 					<field name="name" invisible="1"/>
 				</xpath>
 				<xpath expr="//field[@name='product_id']" position="replace">
                    
					<field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, parent.partner_id)"/>
 				</xpath> 
 				
 			</field>	
	</record>
	
	
		<record id="kw_stock_moves" model="ir.ui.view">
            <field name="name">kw.stock1</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_tree"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@name='product_id']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 				<xpath expr="//field[@name='product_uos']" position="attributes">
                    <attribute name="string">Goods UOS</attribute>
 				</xpath>
 				
 			</field>	
	</record>
	
	
	<!-- <record id="kw_Incoming_goods" model="ir.ui.view">
            <field name="name">kw.stock2</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_form"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@name='product_id']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 				
 				
 			</field>	
	</record> -->
	
	<record id="kw_picking_out" model="ir.ui.view">
            <field name="name">kw.stock3</field>
            <field name="model">stock.picking.out</field>
            <field name="inherit_id" ref="stock.view_picking_form"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//page[@string='Products']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 				
 				
 			</field>	
	</record>
	
	
	
	 <record id="kw_picking" model="ir.ui.view">
            <field name="name">kw.stock4</field>
            <field name="model">stock.picking.in</field>
            <field name="inherit_id" ref="stock.view_picking_form"/>
            <field name="arch" type="xml" >
            
            	<xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="string">Paying Agent</attribute>
 				</xpath>
 		
            	<xpath expr="//field[@name='partner_id']" position="after">
            		<field name='truck_no'/>
            	</xpath>

            	<xpath expr="//page[@string='Products']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 					
 				<xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="required">1</attribute>
 				</xpath>
            	

 			</field>	
	</record> 
	
	
	<record id="kw_Inventories" model="ir.ui.view">
            <field name="name">kw.stock5</field>
            <field name="model">stock.inventory</field>
            <field name="inherit_id" ref="stock.view_inventory_form"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@name='product_id']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 				<xpath expr="//field[@name='product_uom']" position="attributes">
                    <attribute name="string">Goods Unit of Measures</attribute>
 				</xpath>
 				<xpath expr="//page[@string='Posted Inventory']/field[@name='move_ids']/tree[@string='Stock Moves']/field[@name='product_id']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>	
 			</field>
 			
	</record>
	
	<record id="kw_procurement" model="ir.ui.view">
            <field name="name">kw.stock6</field>
            <field name="model">procurement.order</field>
            <field name="inherit_id" ref="procurement.procurement_form_view"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@name='product_id']" position="attributes">
                    <attribute name="string">Goods Details</attribute>
 				</xpath>
 				
 			</field>	
	</record>
	
	<record id="kw_stock_picking_in" model="ir.ui.view">
            <field name="name">kw.stock7</field>
            <field name="model">stock.picking.in</field>
            <field name="inherit_id" ref="stock.view_picking_in_form"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@string='Supplier']" position="attributes">
                    <attribute name="string">Paying Agent</attribute>
 				</xpath>
 				
 				<xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
 				
 			</field>	
	</record> 
	<record id="kw_stock_picking_in_search" model="ir.ui.view">
            <field name="name">kw.stock.search</field>
            <field name="model">stock.picking.in</field>
            <field name="inherit_id" ref="stock.view_picking_in_search"/>
            
            <field name="arch" type="xml" >
            	<xpath expr="//field[@name='name']" position="after">
                    <field name="backorder_id"/>
                    <field name="origin"/>
                    <field name="date"/>
                    <field name="min_date"/>
                    <field name="invoice_state" groups="account.group_account_invoice"/>
                    <field name="stock_journal_id" widget="selection" groups="account.group_account_user"/>
                    <field name="state"/>
 				</xpath>
 				
 			</field>	
	</record> 
    
	
	<record id="stock_picking_in_inherit_purchase" model="ir.ui.view">
            <field name="name">stock.picking.in.search.inherit</field>
            <field name="model">stock.picking.in</field>
            <field name="inherit_id" ref="purchase.stock_picking_in_inherit_purchase"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='purchase_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
                
            </field>
        </record>
        
        <!-- Invoming Shipment Tree view  -->
        
        
        <record id="kw_stock_in_tree" model="ir.ui.view">
            <field name="name">stock.picking.in.tree</field>
            <field name="model">stock.picking.in</field>
             <field name="inherit_id" ref="stock.view_picking_in_tree"/>
            <field name="arch" type="xml">
            	<xpath expr="//field[@name='origin']" position="attributes">
                     <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='backorder_id']" position="attributes">
                     <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='min_date']" position="replace">
                     <field name="product"/>
	                  <field name="qty"/>
                </xpath>
                <!-- <xpath expr="//field[@name='partner_id']" position="attributes">
                     <attribute name="name">Facilitator</attribute>
                </xpath> -->
             	<xpath expr="//field[@name='invoice_state']" position="attributes">
                     <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='stock_journal_id']" position="attributes">
                     <attribute name="invisible">1</attribute>
                </xpath>
              	<xpath expr="//field[@name='stock_journal_id']" position="after">
                     <field name="location_id" invisible="1"/>
                </xpath>
	              
	                
                
            </field>
       </record>
        
        
        
        
	
	</data>	
</openerp>